(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[279],{854:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var s=a(2115),r=a(5380);let n=()=>{let e=(0,s.useContext)(r.c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},3011:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return r}});let s=a(2115);function r(e,t){let a=(0,s.useRef)(null),r=(0,s.useRef)(null);return(0,s.useCallback)(s=>{if(null===s){let e=a.current;e&&(a.current=null,e());let t=r.current;t&&(r.current=null,t())}else e&&(a.current=n(e,s)),t&&(r.current=n(t,s))},[e,t])}function n(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let a=e(t);return"function"==typeof a?a:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},3998:(e,t,a)=>{"use strict";a.d(t,{$:()=>o});var s=a(5155),r=a(2115),n=a(6673),l=a(3101),i=a(4269);let c=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=r.forwardRef((e,t)=>{let{className:a,variant:r,size:l,asChild:o=!1,...d}=e,m=o?n.DX:"button";return(0,s.jsx)(m,{className:(0,i.cn)(c({variant:r,size:l,className:a})),ref:t,...d})});o.displayName="Button"},4269:(e,t,a)=>{"use strict";a.d(t,{cn:()=>n});var s=a(2821),r=a(5889);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.QP)((0,s.$)(t))}},4432:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var s=a(5155),r=a(2115),n=a(63),l=a(854);let i=e=>{let{children:t}=e,{isAuthenticated:a,isLoading:i}=(0,l.A)(),c=(0,n.useRouter)();return((0,r.useEffect)(()=>{i||a||c.push("/login")},[a,i,c]),i)?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-cyan-50",children:(0,s.jsxs)("div",{className:"text-center space-y-4",children:[(0,s.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Đang tải..."})]})}):a?(0,s.jsx)(s.Fragment,{children:t}):null}},5183:(e,t,a)=>{"use strict";a.d(t,{IU:()=>o,MV:()=>c,lc:()=>i,y1:()=>l});var s=a(5125);let r="https://api-client.nroflux.com/api/v1",n=s.A.create({baseURL:r,timeout:1e4,headers:{"Content-Type":"application/json"}});n.interceptors.request.use(e=>{{let t=localStorage.getItem("authToken");t&&(e.headers.Authorization="Bearer ".concat(t))}return e}),n.interceptors.response.use(e=>e,e=>{var t;return(null==(t=e.response)?void 0:t.status)===401&&(localStorage.removeItem("authToken"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)});let l={login:async e=>(await n.post("/auth/login",e)).data,register:async e=>(await n.post("/auth/register",e)).data,getProfile:async()=>(await n.get("/auth/profile")).data,refreshToken:async()=>(await n.post("/auth/refresh")).data},i={getAllItems:async()=>(await n.get("/items")).data,getItemById:async e=>(await n.get("/items/".concat(e))).data},c={createPayment:async e=>(await n.post("/payments",e)).data,createMobileCardPayment:async(e,t)=>{let a={...e,itemId:t};return(await n.post("/payments/mobile-card",a)).data},getMyPayments:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(await n.get("/payments/my",{params:{limit:e,skip:t}})).data},streamPaymentByRefCode:(e,t)=>{let a=null!=t?t:localStorage.getItem("authToken")||"";return new EventSource("".concat(r,"/payments/stream/").concat(encodeURIComponent(e),"?token=").concat(encodeURIComponent(a)))}},o={getUserHistory:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return(await n.get("/transactions/history",{params:{page:e,limit:t}})).data}}},5380:(e,t,a)=>{"use strict";a.d(t,{AuthProvider:()=>l,c:()=>n});var s=a(5155),r=a(2115);let n=(0,r.createContext)(void 0),l=e=>{let{children:t}=e,[a,l]=(0,r.useState)(null),[i,c]=(0,r.useState)(null),[o,d]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{{let e=localStorage.getItem("authToken"),t=localStorage.getItem("user");if(e&&t)try{let a=JSON.parse(t);c(e),l(a)}catch(e){console.error("Error parsing stored user data:",e),localStorage.removeItem("authToken"),localStorage.removeItem("user")}}d(!1)},[]),(0,s.jsx)(n.Provider,{value:{user:a,token:i,isAuthenticated:!!i&&!!a,isLoading:o,login:(e,t)=>{localStorage.setItem("authToken",e),localStorage.setItem("user",JSON.stringify(t)),c(e),l(t)},logout:()=>{localStorage.removeItem("authToken"),localStorage.removeItem("user"),c(null),l(null)}},children:t})}},5686:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>S});var s=a(5155),r=a(2115),n=a(6948),l=a(3998),i=a(6444),c=a(4744),o=a(8519),d=a(1847);let m=(0,d.A)("building-2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);var h=a(7910),u=a(508),x=a(4926);let p=(0,d.A)("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]),g=(0,d.A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),f=(0,d.A)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),b=(0,d.A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),y=(0,d.A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),v=(0,d.A)("qr-code",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);var j=a(5239),N=a(5183),w=a(854),k=a(63);let M=()=>{var e,t,a,d;let M=(0,k.useRouter)(),{user:C,logout:S}=(0,w.A)(),[R,A]=(0,r.useState)({selectedItemId:"",paymentMethod:"mobile-card"}),[I,E]=(0,r.useState)([]),[P,T]=(0,r.useState)(null),[D,V]=(0,r.useState)(!0),[q,z]=(0,r.useState)(!1),[_,B]=(0,r.useState)(!1),[Z,F]=(0,r.useState)(null),O=(0,r.useRef)(null),[J,L]=(0,r.useState)(!1),[$,Q]=(0,r.useState)(!1),[H,U]=(0,r.useState)({cardCode:"",cardSeri:"",telco:"",amount:0}),[W,G]=(0,r.useState)(null),[K,X]=(0,r.useState)(0),Y=(0,r.useRef)(null);(0,r.useEffect)(()=>{(async()=>{try{V(!0),F(null);let e=await N.lc.getAllItems();e.success&&e.data?E(e.data.items):F("Kh\xf4ng thể tải danh s\xe1ch sản phẩm")}catch(e){console.error("Error loading items:",e),F("Đ\xe3 xảy ra lỗi khi tải danh s\xe1ch sản phẩm")}finally{V(!1)}})()},[]),(0,r.useEffect)(()=>{let e=e=>{O.current&&!O.current.contains(e.target)&&z(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,r.useEffect)(()=>{let e=null;return W&&(e=setInterval(()=>{let t=Date.now(),a=Math.max(0,W.expiresAt-t);if(a>0)X(a);else{G(null),X(0),Q(!1);try{c.oR.error("QR đ\xe3 hết hạn. Vui l\xf2ng tạo lại giao dịch.")}catch(e){}e&&clearInterval(e)}},1e3)),()=>{e&&clearInterval(e)}},[W]),(0,r.useEffect)(()=>{var e;let t=null==W||null==(e=W.paymentData)?void 0:e.refCode;if(t)try{let e=N.MV.streamPaymentByRefCode(t);Y.current=e;let a=e=>{console.log("SSE event:",e);try{let t=JSON.parse(e.data),a=null==t?void 0:t.status;if("PAID"===a){G(null),X(0),Q(!1);try{c.oR.success("Thanh to\xe1n th\xe0nh c\xf4ng!")}catch(e){}}else if("EXPIRED"===a){G(null),X(0),Q(!1);try{c.oR.error("QR đ\xe3 hết hạn. Vui l\xf2ng tạo lại giao dịch.")}catch(e){}}}catch(e){}};return e.addEventListener("payment.initial",a),e.addEventListener("payment.updated",a),e.onerror=e=>{console.error("SSE error:",e)},()=>{try{console.log("SSE cleanup:",e),e.close()}catch(e){}Y.current=null}}catch(e){}},[null==W||null==(e=W.paymentData)?void 0:e.refCode]);let ee=(0,r.useCallback)(async()=>{if(!P)return;let e=Date.now();if(W&&W.itemId===P.id&&W.expiresAt>e){X(W.expiresAt-e),console.log("Using cached payment:",W.paymentData);return}B(!0);try{let t=await N.MV.createPayment({itemId:P.id});t.success&&t.data?(G({paymentData:t.data,itemId:P.id,expiresAt:e+9e5}),X(9e5),console.log("New banking payment created:",t.data)):(c.oR.error(t.message||"Tạo thanh to\xe1n thất bại"),Q(!1))}catch(e){var t,a,s,r,n;console.error("Banking payment error:",e),(null==(t=e.response)?void 0:t.status)===429?c.oR.error((null==(s=e.response)||null==(a=s.data)?void 0:a.message)||"Bạn đ\xe3 c\xf3 qu\xe1 nhiều giao dịch chuyển khoản đang chờ xử l\xfd. Vui l\xf2ng ho\xe0n th\xe0nh c\xe1c giao dịch hiện tại trước khi tạo giao dịch mới."):c.oR.error((null==(n=e.response)||null==(r=n.data)?void 0:r.message)||"Đ\xe3 xảy ra lỗi khi tạo thanh to\xe1n"),Q(!1)}finally{B(!1)}},[P,W]);(0,r.useEffect)(()=>{$&&P&&ee()},[$,P,ee]),(0,r.useEffect)(()=>{if(!J||!P||"mobile-card"!==R.paymentMethod)return;let e=P.price||0;!(e>5e5)&&0===H.amount&&[2e4,5e4,1e5,2e5,5e5].includes(e)&&U(t=>({...t,amount:e}))},[J,P,R.paymentMethod,H.amount]);let et=async e=>{if(e.preventDefault(),!P)return void c.oR.error("Vui l\xf2ng chọn sản phẩm");if("mobile-card"===R.paymentMethod&&(P.price||0)>5e5){try{c.oR.error("G\xf3i tr\xean 500.000đ kh\xf4ng hỗ trợ nạp thẻ. Vui l\xf2ng chọn chuyển khoản.")}catch(e){}A(e=>({...e,paymentMethod:"banking"}));return}"banking"===R.paymentMethod&&W&&W.itemId!==P.id&&(G(null),X(0),console.log("Cleared cached payment due to different item selected at payment time")),"mobile-card"===R.paymentMethod?L(!0):"banking"===R.paymentMethod&&Q(!0)},ea=async e=>{if(e.preventDefault(),!H.cardCode||!H.cardSeri||!H.telco||!H.amount)return void c.oR.error("Vui l\xf2ng điền đầy đủ th\xf4ng tin thẻ v\xe0 chọn mệnh gi\xe1");B(!0);try{let e=await N.MV.createMobileCardPayment(H,(null==P?void 0:P.id)||"");e.success&&e.data?(c.oR.success("Nạp thẻ th\xe0nh c\xf4ng! M\xe3 tham chiếu: ".concat(e.data.refCode)),L(!1),U({cardCode:"",cardSeri:"",telco:"",amount:0})):c.oR.error(e.message||"Nạp thẻ thất bại")}catch(e){var t,a;console.error("Mobile card payment error:",e),c.oR.error((null==(a=e.response)||null==(t=a.data)?void 0:t.message)||"Đ\xe3 xảy ra lỗi khi nạp thẻ")}finally{B(!1)}},es=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e),er=P&&P.price||0,en=((null==P?void 0:P.price)||0)>5e5,el=[{id:"mobile-card",name:"Thẻ điện thoại",description:"Nạp bằng thẻ c\xe0o điện thoại",icon:o.A,iconColor:"text-blue-600"},{id:"banking",name:"Chuyển khoản ng\xe2n h\xe0ng",description:"Thanh to\xe1n qua chuyển khoản",icon:m,iconColor:"text-green-600"}];return(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-b from-yellow-50 via-amber-50 to-white",children:[(0,s.jsx)("header",{className:"sticky top-0 z-50 bg-white/70 backdrop-blur border-b border-amber-100 shadow-sm",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"h-9 w-9 rounded-full bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center shadow",children:(0,s.jsx)(h.A,{className:"h-5 w-5 text-white"})}),(0,s.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Ngọc Rồng Online"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("div",{className:"hidden sm:flex items-center space-x-2 text-sm text-gray-700",children:[(0,s.jsx)(u.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"truncate max-w-[160px]",title:null!=(d=null==C?void 0:C.username)?d:"",children:null==C?void 0:C.username})]}),(0,s.jsxs)(l.$,{onClick:()=>{S(),M.push("/")},variant:"outline",size:"sm",className:"flex items-center space-x-2 border-rose-200 text-rose-700 hover:bg-rose-50",children:[(0,s.jsx)(x.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:"Đăng xuất"})]})]})]})})}),(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-7xl checkout-container",children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Thanh to\xe1n"}),(0,s.jsx)("p",{className:"text-gray-700 text-lg",children:"Ho\xe0n tất đơn h\xe0ng của bạn một c\xe1ch an to\xe0n"})]}),Z&&(0,s.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,s.jsx)("p",{className:"text-red-800 text-sm",children:Z})}),(0,s.jsx)("form",{onSubmit:et,children:(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)(n.Zp,{className:"shadow-sm border-0 bg-white",children:[(0,s.jsx)(n.aR,{className:"pb-4",children:(0,s.jsxs)(n.ZB,{className:"flex items-center gap-3 text-xl",children:[(0,s.jsx)("div",{className:"p-2 bg-amber-50 rounded-lg",children:(0,s.jsx)(p,{className:"h-5 w-5 text-amber-600"})}),"Chọn sản phẩm"]})}),(0,s.jsx)(n.Wu,{className:"space-y-4",children:D?(0,s.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,s.jsx)(g,{className:"h-6 w-6 animate-spin text-blue-600"}),(0,s.jsx)("span",{className:"ml-2 text-slate-600",children:"Đang tải danh s\xe1ch..."})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(i.J,{className:"text-slate-700 font-medium",children:"Sản phẩm *"}),(0,s.jsxs)("div",{className:"relative",ref:O,children:[(0,s.jsxs)("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),z(!q)},className:"w-full flex items-center justify-between px-4 py-3 border border-slate-200 rounded-lg bg-white hover:border-amber-500 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-colors",children:[(0,s.jsx)("span",{className:P?"text-slate-900":"text-slate-500",children:P?P.name||"T\xean kh\xf4ng x\xe1c định":"Chọn sản phẩm..."}),(0,s.jsx)(f,{className:"h-4 w-4 text-slate-400 transition-transform ".concat(q?"rotate-180":"")})]}),q&&(0,s.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:0===I.length?(0,s.jsx)("div",{className:"px-4 py-3 text-slate-500 text-sm",children:"Kh\xf4ng c\xf3 sản phẩm n\xe0o"}):I.map(e=>(0,s.jsx)("button",{type:"button",onClick:t=>{t.preventDefault(),t.stopPropagation(),(e=>{console.log("Selecting item:",e),T(e);let t=(e.price||0)>5e5,a="mobile-card"===R.paymentMethod&&t;if(A(a=>({...a,selectedItemId:e.id,paymentMethod:"mobile-card"===a.paymentMethod&&t?"banking":a.paymentMethod})),"mobile-card"===R.paymentMethod&&U(e=>({...e,amount:0})),a)try{c.oR.info("G\xf3i tr\xean 500.000đ chỉ hỗ trợ chuyển khoản. Đ\xe3 chuyển sang phương thức chuyển khoản.")}catch(e){}z(!1),console.log("Item selected, dropdown closed")})(e)},className:"w-full px-4 py-3 text-left hover:bg-slate-50 border-b border-slate-100 last:border-b-0 transition-colors",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-slate-900",children:e.name||"T\xean kh\xf4ng x\xe1c định"}),(0,s.jsx)("p",{className:"text-sm text-slate-500 capitalize",children:e.type?e.type.toLowerCase().replace("_"," "):"Kh\xf4ng x\xe1c định"})]}),(0,s.jsx)("p",{className:"font-semibold text-blue-600",children:es(e.price||0)})]})},e.id))})]})]}),P&&(0,s.jsx)("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-blue-900",children:"Sản phẩm đ\xe3 chọn"}),(0,s.jsx)("p",{className:"text-sm text-blue-700",children:"Số lượng: 1"})]}),(0,s.jsx)("div",{className:"text-right",children:(0,s.jsx)("p",{className:"font-semibold text-blue-900",children:es(P.price||0)})})]})})]})})]}),(0,s.jsxs)(n.Zp,{className:"shadow-sm border-0 bg-white",children:[(0,s.jsx)(n.aR,{className:"pb-4",children:(0,s.jsxs)(n.ZB,{className:"flex items-center gap-3 text-xl",children:[(0,s.jsx)("div",{className:"p-2 bg-purple-50 rounded-lg",children:(0,s.jsx)(o.A,{className:"h-5 w-5 text-purple-600"})}),"Phương thức thanh to\xe1n"]})}),(0,s.jsx)(n.Wu,{children:(0,s.jsx)("div",{className:"space-y-3",children:el.map(e=>{let t=e.icon,a=R.paymentMethod===e.id,r="mobile-card"===e.id&&en;return(0,s.jsxs)("label",{htmlFor:e.id,className:"flex items-center space-x-4 p-4 border rounded-xl transition-all ".concat(a?"border-amber-500 bg-amber-50 ring-2 ring-amber-200":"border-slate-200 hover:bg-slate-50"," ").concat(r?"opacity-60 cursor-not-allowed":"cursor-pointer"),title:r?"G\xf3i tr\xean 500.000đ kh\xf4ng hỗ trợ nạp thẻ":void 0,children:[(0,s.jsx)("input",{type:"radio",id:e.id,name:"paymentMethod",value:e.id,checked:a,onChange:e=>(e=>{if(console.log("Payment method changing to:",e),console.log("Current formData:",R),"mobile-card"===e&&P&&(P.price||0)>5e5){try{c.oR.error("G\xf3i tr\xean 500.000đ kh\xf4ng hỗ trợ nạp thẻ. Vui l\xf2ng chọn chuyển khoản.")}catch(e){}A(e=>({...e,paymentMethod:"banking"}));return}A(t=>{let a={...t,paymentMethod:e};return console.log("New formData:",a),a}),"mobile-card"===e&&U(e=>({...e,amount:0}))})(e.target.value),disabled:r,className:"w-4 h-4 text-amber-600 border-slate-300 focus:ring-amber-500"}),(0,s.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,s.jsx)("div",{className:"p-2 bg-slate-50 rounded-lg",children:(0,s.jsx)(t,{className:"h-5 w-5 ".concat(e.iconColor)})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-slate-900",children:e.name}),(0,s.jsx)("p",{className:"text-sm text-slate-500",children:e.description}),r&&(0,s.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"G\xf3i tr\xean 500.000đ chỉ hỗ trợ chuyển khoản."})]})]})]},e.id)})})})]})]}),(0,s.jsx)("div",{className:"sticky-sidebar",children:(0,s.jsxs)(n.Zp,{className:"shadow-lg border-0 bg-white",children:[(0,s.jsx)(n.aR,{className:"pb-4",children:(0,s.jsxs)(n.ZB,{className:"flex items-center gap-3 text-xl",children:[(0,s.jsx)("div",{className:"p-2 bg-orange-50 rounded-lg",children:(0,s.jsx)(p,{className:"h-5 w-5 text-orange-600"})}),"Th\xf4ng tin đơn h\xe0ng"]})}),(0,s.jsxs)(n.Wu,{className:"space-y-6",children:[P?(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between py-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-slate-100 to-slate-200 rounded-xl flex items-center justify-center shadow-sm",children:(0,s.jsx)(p,{className:"h-6 w-6 text-slate-400"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-semibold text-slate-900 text-sm",children:P.name||"T\xean kh\xf4ng x\xe1c định"}),(0,s.jsx)("p",{className:"text-sm text-slate-500 capitalize",children:P.type?P.type.toLowerCase().replace("_"," "):"Kh\xf4ng x\xe1c định"}),(0,s.jsx)("p",{className:"text-sm text-slate-500",children:"Số lượng: 1"})]})]}),(0,s.jsx)("p",{className:"font-semibold text-slate-900",children:es(P.price||0)})]})}):(0,s.jsxs)("div",{className:"text-center py-8 text-slate-500",children:[(0,s.jsx)(p,{className:"h-12 w-12 mx-auto mb-3 text-slate-300"}),(0,s.jsx)("p",{children:"Chưa chọn sản phẩm n\xe0o"})]}),P&&(0,s.jsx)("div",{className:"space-y-3 pt-4 border-t border-slate-200",children:(0,s.jsxs)("div",{className:"flex justify-between text-lg font-bold",children:[(0,s.jsx)("span",{className:"text-slate-900",children:"Tổng cộng"}),(0,s.jsx)("span",{className:"text-blue-600",children:es(er)})]})}),(0,s.jsx)("div",{className:"pt-4",children:(0,s.jsx)(l.$,{type:"submit",disabled:_||!P,className:"w-full bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-700 hover:to-orange-700 text-white py-4 text-lg font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-[1.02] disabled:opacity-50",size:"lg",children:_?(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Đang xử l\xfd..."]}):P?"Thanh to\xe1n ".concat(es(er)):"Chọn sản phẩm để tiếp tục"})}),(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2 text-sm text-slate-500 pt-4",children:[(0,s.jsx)(h.A,{className:"h-4 w-4"}),(0,s.jsx)("p",{children:"Th\xf4ng tin của bạn được bảo mật v\xe0 m\xe3 h\xf3a"})]})]})]})})]})}),J&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/10 flex items-center justify-center z-50 p-4 sm:p-6",children:(0,s.jsxs)(n.Zp,{className:"w-full max-w-md bg-white max-h-[90vh] overflow-y-auto",children:[(0,s.jsx)(n.aR,{className:"pb-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(n.ZB,{className:"flex items-center gap-3 text-xl",children:[(0,s.jsx)(o.A,{className:"h-6 w-6 text-blue-600"}),"Nạp thẻ điện thoại"]}),(0,s.jsx)("button",{onClick:()=>L(!1),className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",children:(0,s.jsx)(b,{className:"h-5 w-5"})})]})}),(0,s.jsxs)(n.Wu,{children:[(0,s.jsxs)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-red-800",children:[(0,s.jsx)(y,{className:"h-4 w-4"}),(0,s.jsx)("p",{className:"text-sm font-medium",children:"Cảnh b\xe1o quan trọng"})]}),(0,s.jsx)("p",{className:"text-xs text-red-700 mt-1",children:"Vui l\xf2ng kiểm tra kỹ th\xf4ng tin trước khi gửi. Nhập sai th\xf4ng tin c\xf3 thể l\xe0m mất thẻ!"})]}),(0,s.jsxs)("form",{onSubmit:ea,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(i.J,{htmlFor:"telco",className:"text-slate-700 font-medium",children:"Nh\xe0 cung cấp *"}),(0,s.jsxs)("select",{id:"telco",value:H.telco,onChange:e=>U(t=>({...t,telco:e.target.value})),className:"w-full px-3 py-3 text-base border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500",required:!0,children:[(0,s.jsx)("option",{value:"",children:"Chọn nh\xe0 cung cấp"}),(0,s.jsx)("option",{value:"viettel",children:"Viettel"}),(0,s.jsx)("option",{value:"mobifone",children:"MobiFone"}),(0,s.jsx)("option",{value:"vinaphone",children:"VinaPhone"})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(i.J,{htmlFor:"cardValue",className:"text-slate-700 font-medium",children:"Mệnh gi\xe1 thẻ *"}),(0,s.jsx)("p",{className:"text-xs text-slate-500 mb-1",children:"Vui l\xf2ng chọn mệnh gi\xe1 thẻ ph\xf9 hợp với g\xf3i của bạn."}),(0,s.jsxs)("select",{id:"cardValue",value:H.amount,onChange:e=>{U(t=>({...t,amount:parseInt(e.target.value)}))},className:"w-full px-3 py-3 text-base border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500",required:!0,children:[(0,s.jsx)("option",{value:"",children:"Chọn mệnh gi\xe1"}),(0,s.jsx)("option",{value:"10000",children:es(1e4)}),(0,s.jsx)("option",{value:"20000",children:es(2e4)}),(0,s.jsx)("option",{value:"50000",children:es(5e4)}),(0,s.jsx)("option",{value:"100000",children:es(1e5)}),(0,s.jsx)("option",{value:"200000",children:es(2e5)}),(0,s.jsx)("option",{value:"500000",children:es(5e5)})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(i.J,{htmlFor:"cardSeri",className:"text-slate-700 font-medium",children:"Số seri *"}),(0,s.jsx)("input",{id:"cardSeri",type:"text",placeholder:"Nhập số seri thẻ",value:H.cardSeri,onChange:e=>U(t=>({...t,cardSeri:e.target.value})),className:"w-full px-3 py-3 text-base border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500",required:!0})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(i.J,{htmlFor:"cardCode",className:"text-slate-700 font-medium",children:"M\xe3 thẻ *"}),(0,s.jsx)("input",{id:"cardCode",type:"text",placeholder:"Nhập m\xe3 thẻ",value:H.cardCode,onChange:e=>U(t=>({...t,cardCode:e.target.value})),className:"w-full px-3 py-3 text-base border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500",required:!0})]}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[(0,s.jsx)(l.$,{type:"button",variant:"outline",onClick:()=>L(!1),className:"flex-1 py-3 text-base border-amber-200 text-amber-700 hover:bg-amber-50",disabled:_,children:"Hủy"}),(0,s.jsx)(l.$,{type:"submit",className:"flex-1 bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-700 hover:to-orange-700 py-3 text-base text-white shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-[1.02]",disabled:_,children:_?(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(g,{className:"h-4 w-4 animate-spin"}),"Đang xử l\xfd..."]}):"Nạp thẻ"})]})]})]})]})}),$&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/10 flex items-center justify-center z-50 p-4 sm:p-6",children:(0,s.jsxs)(n.Zp,{className:"w-full max-w-md bg-white max-h-[90vh] overflow-y-auto",children:[(0,s.jsx)(n.aR,{className:"pb-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(n.ZB,{className:"flex items-center gap-3 text-xl",children:[(0,s.jsx)(m,{className:"h-6 w-6 text-green-600"}),"Chuyển khoản ng\xe2n h\xe0ng"]}),(0,s.jsx)("button",{onClick:()=>Q(!1),className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",children:(0,s.jsx)(b,{className:"h-5 w-5"})})]})}),(0,s.jsx)(n.Wu,{className:"text-center",children:_?(0,s.jsxs)("div",{className:"py-8",children:[(0,s.jsx)(g,{className:"h-8 w-8 animate-spin text-green-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-slate-600",children:"Đang tạo th\xf4ng tin thanh to\xe1n..."})]}):(0,s.jsxs)("div",{className:"space-y-4",children:[K>0&&(0,s.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),(0,s.jsxs)("p",{className:"text-sm font-medium text-blue-800",children:["C\xf2n lại:"," ",(0,s.jsx)("span",{className:"font-mono text-lg",children:(e=>{let t=Math.floor(e/1e3),a=Math.floor(t/60);return"".concat(a.toString().padStart(2,"0"),":").concat((t%60).toString().padStart(2,"0"))})(K)})]})]}),(0,s.jsx)("p",{className:"text-xs text-blue-600 mt-1",children:"QR code sẽ hết hạn sau thời gian n\xe0y"})]}),(0,s.jsxs)("div",{className:"w-full max-w-xs sm:max-w-sm mx-auto",children:[(0,s.jsx)("div",{className:"relative w-full aspect-square",children:(0,s.jsx)(j.default,{src:"https://img.vietqr.io/image/MB-121220001012-qr_only.png?addInfo=".concat((null==W||null==(t=W.paymentData)?void 0:t.refCode)||(null==W||null==(a=W.paymentData)?void 0:a.id)||"PAYMENT","&amount=").concat(er),alt:"QR Code thanh to\xe1n",fill:!0,className:"rounded-lg border border-slate-200 shadow-sm object-contain",sizes:"(max-width: 640px) 320px, 384px",priority:!0,onError:e=>{var t;let a=e.target;a.style.display="none";let s=null==(t=a.parentElement)?void 0:t.nextElementSibling;s&&(s.style.display="flex")}})}),(0,s.jsx)("div",{className:"w-full h-48 bg-gradient-to-br from-green-100 to-green-200 rounded-lg items-center justify-center hidden",style:{display:"none"},children:(0,s.jsx)(v,{className:"h-16 w-16 sm:h-24 sm:w-24 text-green-600"})})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h3",{className:"font-semibold text-slate-900",children:"Qu\xe9t m\xe3 QR để thanh to\xe1n"}),(0,s.jsx)("p",{className:"text-sm text-slate-600",children:"Sử dụng ứng dụng ng\xe2n h\xe0ng của bạn để qu\xe9t m\xe3 QR"}),(0,s.jsxs)("div",{className:"mt-4 p-4 bg-slate-50 rounded-lg space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Số tiền:"}),(0,s.jsx)("span",{className:"text-lg font-bold text-green-600",children:es(er)})]}),(null==W?void 0:W.paymentData)&&(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"M\xe3 giao dịch:"}),(0,s.jsx)("span",{className:"text-sm font-mono font-semibold text-blue-600",children:W.paymentData.refCode||W.paymentData.id})]}),(0,s.jsx)("div",{className:"pt-2 border-t border-slate-200",children:(0,s.jsx)("p",{className:"text-xs text-slate-500 text-center",children:"Ng\xe2n h\xe0ng: MB Bank • STK: 121220001012"})})]})]}),(0,s.jsx)(l.$,{onClick:()=>Q(!1),className:"w-full mt-4 py-3 text-base border-amber-200 text-amber-700 hover:bg-amber-50",variant:"outline",children:"Đ\xf3ng"})]})})]})})]})]})};var C=a(4432);function S(){return(0,s.jsx)(C.A,{children:(0,s.jsx)(M,{})})}},6444:(e,t,a)=>{"use strict";a.d(t,{J:()=>o});var s=a(5155),r=a(2115),n=a(6554),l=a(3101),i=a(4269);let c=(0,l.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.b,{ref:t,className:(0,i.cn)(c(),a),...r})});o.displayName=n.b.displayName},6554:(e,t,a)=>{"use strict";a.d(t,{b:()=>c});var s=a(2115);a(7650);var r=a(6673),n=a(5155),l=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{let a=(0,r.TL)(`Primitive.${t}`),l=s.forwardRef((e,s)=>{let{asChild:r,...l}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,n.jsx)(r?a:t,{...l,ref:s})});return l.displayName=`Primitive.${t}`,{...e,[t]:l}},{}),i=s.forwardRef((e,t)=>(0,n.jsx)(l.label,{...e,ref:t,onMouseDown:t=>{var a;t.target.closest("button, input, select, textarea")||(null==(a=e.onMouseDown)||a.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));i.displayName="Label";var c=i},6948:(e,t,a)=>{"use strict";a.d(t,{BT:()=>o,Wu:()=>d,ZB:()=>c,Zp:()=>l,aR:()=>i});var s=a(5155),r=a(2115),n=a(4269);let l=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...r})});l.displayName="Card";let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",a),...r})});i.displayName="CardHeader";let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",a),...r})});c.displayName="CardTitle";let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...r})});o.displayName="CardDescription";let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",a),...r})});d.displayName="CardContent",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",a),...r})}).displayName="CardFooter"},7644:(e,t,a)=>{Promise.resolve().then(a.bind(a,5686))}},e=>{e.O(0,[125,87,843,744,441,255,358],()=>e(e.s=7644)),_N_E=e.O()}]);