(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[429],{854:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(2115),s=a(5380);let l=()=>{let e=(0,r.useContext)(s.c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},1840:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var r=a(5155),s=a(2115),l=a(5183),n=a(854);function o(){let{user:e}=(0,n.A)(),[t,a]=(0,s.useState)(1),[o]=(0,s.useState)(20),[i,c]=(0,s.useState)(!1),[d,u]=(0,s.useState)(null),[m,h]=(0,s.useState)(null),g=async()=>{try{c(!0),u(null);let e=await l.IU.getUserHistory(t,o);e.success?h(e.data):u(e.error||"Fetch error")}catch(e){e instanceof Error?u(e.message||"Unknown error"):u("Unknown error")}finally{c(!1)}};return(0,s.useEffect)(()=>{g()},[t]),(0,r.jsxs)("div",{className:"max-w-5xl mx-auto p-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Lịch sử giao dịch"}),i&&(0,r.jsx)("p",{children:"Đang tải..."}),d&&(0,r.jsx)("p",{className:"text-red-600",children:d}),!i&&!d&&m&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"space-y-4",children:[0===m.data.length&&(0,r.jsx)("p",{children:"Kh\xf4ng c\xf3 giao dịch n\xe0o."}),m.data.map(t=>{let a=(null==e?void 0:e._id)||(null==e?void 0:e.username)||"",s=t.player1.id.toString()===a.toString(),l=s?t.player2:t.player1;return(0,r.jsxs)("div",{className:"border rounded p-3 bg-white shadow-sm",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[(0,r.jsxs)("span",{children:["Đối t\xe1c: ",(0,r.jsx)("strong",{children:l.name})," (#",l.id,")"]}),(0,r.jsx)("span",{children:new Date(t.timeTran).toLocaleString()})]}),(0,r.jsxs)("div",{className:"mt-2 grid md:grid-cols-2 gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold",children:"Bạn đưa"}),(0,r.jsxs)("ul",{className:"list-disc ml-4",children:[(s?t.itemsP1:t.itemsP2).map((e,t)=>{var a;return(0,r.jsxs)("li",{children:[e.name," x",null!=(a=e.quantityGD)?a:e.quantity]},t)}),(()=>{var e,a,l,n;let o=s?(null!=(e=t.gold1After)?e:0)-(null!=(a=t.gold1Before)?a:0):(null!=(l=t.gold2After)?l:0)-(null!=(n=t.gold2Before)?n:0);return o<0?(0,r.jsxs)("li",{children:["Gold: ",Math.abs(o)]}):null})()]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold",children:"Bạn nhận"}),(0,r.jsxs)("ul",{className:"list-disc ml-4",children:[(s?t.itemsP2:t.itemsP1).map((e,t)=>{var a;return(0,r.jsxs)("li",{children:[e.name," x",null!=(a=e.quantityGD)?a:e.quantity]},t)}),(()=>{var e,a,l,n;let o=s?(null!=(e=t.gold1After)?e:0)-(null!=(a=t.gold1Before)?a:0):(null!=(l=t.gold2After)?l:0)-(null!=(n=t.gold2Before)?n:0);return o>0?(0,r.jsxs)("li",{children:["Gold: ",Math.abs(o)]}):null})()]})]})]})]},t._id)})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4 mt-6",children:[(0,r.jsx)("button",{disabled:!m.hasPrev||i,onClick:()=>a(e=>Math.max(1,e-1)),className:"px-3 py-1 border rounded disabled:opacity-50",children:"Prev"}),(0,r.jsxs)("span",{children:["Trang ",m.page,"/",m.totalPages]}),(0,r.jsx)("button",{disabled:!m.hasNext||i,onClick:()=>a(e=>e+1),className:"px-3 py-1 border rounded disabled:opacity-50",children:"Next"})]})]})]})}},5183:(e,t,a)=>{"use strict";a.d(t,{IU:()=>c,MV:()=>i,lc:()=>o,y1:()=>n});var r=a(5125);let s="https://api-client.nroflux.com/api/v1",l=r.A.create({baseURL:s,timeout:1e4,headers:{"Content-Type":"application/json"}});l.interceptors.request.use(e=>{{let t=localStorage.getItem("authToken");t&&(e.headers.Authorization="Bearer ".concat(t))}return e}),l.interceptors.response.use(e=>e,e=>{var t;return(null==(t=e.response)?void 0:t.status)===401&&(localStorage.removeItem("authToken"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)});let n={login:async e=>(await l.post("/auth/login",e)).data,register:async e=>(await l.post("/auth/register",e)).data,getProfile:async()=>(await l.get("/auth/profile")).data,refreshToken:async()=>(await l.post("/auth/refresh")).data},o={getAllItems:async()=>(await l.get("/items")).data,getItemById:async e=>(await l.get("/items/".concat(e))).data},i={createPayment:async e=>(await l.post("/payments",e)).data,createMobileCardPayment:async(e,t)=>{let a={...e,itemId:t};return(await l.post("/payments/mobile-card",a)).data},getMyPayments:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(await l.get("/payments/my",{params:{limit:e,skip:t}})).data},streamPaymentByRefCode:(e,t)=>{let a=null!=t?t:localStorage.getItem("authToken")||"";return new EventSource("".concat(s,"/payments/stream/").concat(encodeURIComponent(e),"?token=").concat(encodeURIComponent(a)))}},c={getUserHistory:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return(await l.get("/transactions/history",{params:{page:e,limit:t}})).data}}},5380:(e,t,a)=>{"use strict";a.d(t,{AuthProvider:()=>n,c:()=>l});var r=a(5155),s=a(2115);let l=(0,s.createContext)(void 0),n=e=>{let{children:t}=e,[a,n]=(0,s.useState)(null),[o,i]=(0,s.useState)(null),[c,d]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{{let e=localStorage.getItem("authToken"),t=localStorage.getItem("user");if(e&&t)try{let a=JSON.parse(t);i(e),n(a)}catch(e){console.error("Error parsing stored user data:",e),localStorage.removeItem("authToken"),localStorage.removeItem("user")}}d(!1)},[]),(0,r.jsx)(l.Provider,{value:{user:a,token:o,isAuthenticated:!!o&&!!a,isLoading:c,login:(e,t)=>{localStorage.setItem("authToken",e),localStorage.setItem("user",JSON.stringify(t)),i(e),n(t)},logout:()=>{localStorage.removeItem("authToken"),localStorage.removeItem("user"),i(null),n(null)}},children:t})}},6328:(e,t,a)=>{Promise.resolve().then(a.bind(a,1840))}},e=>{e.O(0,[125,441,255,358],()=>e(e.s=6328)),_N_E=e.O()}]);